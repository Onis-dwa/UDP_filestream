﻿## UDP_FileStream

Тривиальный udp клиент-сервер <br/>
Клиент:
1. генерирует количество пакетов
2. заполняет каждый пакет случайными символами (33-126 для "человекочитаемости")
3. отправляет пакеты на сервер в случайном порядке, елси получет ACK ставит флаг на этот пакет, что получен
4. на первый пакет ожидает не нулевой id
5. когда получен пакет ACK с данными (crc), то считает что файл завершён
6. вычисляет crc по своим данным
7. сверяет полученный свой crc с полученным

Сервер:
1. принимает пакет (сингл тред)
2. если пакет не имеет id, генерирует его
3. записывает данные пакета в соответсвующий блок структуры, выбранной из мапы по id
4. когда количество пакетов совпало с ожидаемым, высчитывает crc и отправляет клиенту, удаляя файл
5. каждые 40с если обнаруживает "устаревшие" файлы удаляет их

# Настройки
Все параметры настраиваются в корневом [CMakeLists.txt](CMakeLists.txt)
* -DHOST_ADDR - адрес хоста для сервера и клиента
* -DHOST_PORT - порд хоста для сервера и клиента
* -DMAX_PACKS - максимальное количество пакетов на каждый файл, генерируемый клиентом
* -DCLIENT_LOOP - включение бесконечного цикла в клиенте
* -DPACK_INFO_PRINT - вывод дополнительной информации можно установить включением опции <br/>
Не рекомендую включать данную опцию для числа блоков > 100 <br/>

Выводимая информация на клиенте (-DPACK_INFO_PRINT):
1. Содержимое каждого файла. Выводиться до начала отправки.
2. Информация о получаемых ACK пакетах, где:
	- "from" адрес сервера в big-endian uint32_t ":" порт на сервере bin-endian uint16_t
	- "i" (indx) номер текущего блока
	- "s" (size) размер текущего блока
	- "b" (bound) первые и последние 4 символа блока (всего 8 символов, или столько, сколько возможно вывести)
3. Первый полученный пакет так же выведет дополнительное поле:
	- "id" присвоенный сервером идентификатор
4. При последнем блоке выведеться crc:
	- "mcrc" crc вычисленный клиентом
	- "rcrc" crc вычисленный сервером

Выводимая информация на сервере (-DPACK_INFO_PRINT):
1. Информация о получаемых PUT пакетах, где:
	- "id" идентификатор клиента
	- "i" (indx) номер текущего блока
	- "s" (size) размер текущего блока
	- "b" (bound) первые и последние 4 символа блока (всего 8 символов, или столько, сколько возможно вывести)
2. При последнем блоке:
	- "crc" вычисленную сервером
	- финальное содержимое файла (аналогично клиенту)

Информация о новом файле на клиенте выводиться всегда. <br/>
Информация о новом клиенте на сервере выводиться всегда. <br/>

Если клиент обнаружит несовпадение crc, то завершит свою работу с кодом 3

# Сборка
Linux:
```
   mkdir build
   cd build
   cmake ..
   make
```
Windows: <br/>
Из Visual Studio, для которой есть готовый [CMakeSettings.json](CMakeSettings.json) <br/>
```
   Запустить VS
   (опционально) Выставить свои параметры
   Запустить сборку
```
Иначе аналогично сборке Linux
	
# Запуск
1. Запустить сервер.
2. Убедиться, что bind успешен
3. Запуск клиента(ов)
